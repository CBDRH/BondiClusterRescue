<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="M. Hanly" />
<meta name="author" content="T. Churches" />
<meta name="author" content="O. Fitzgerald" />
<meta name="author" content="CR. MacIntyre" />
<meta name="author" content="L. Jorm" />


<title>In-brief analysis</title>

<!-- HEAD_CONTENT -->

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>


<style type="text/css">
  p.abstract{
    text-align: center;
    font-weight: bold;
  }
  div.abstract{
    margin: auto;
    width: 90%;
  }
</style>






<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="section-header">



<h1 class="title toc-ignore">In-brief analysis</h1>
<h3 class="subtitle">Modelling the current COVID-19 Delta-variant outbreak in Sydney</h3>
<h4 class="author">M. Hanly<a href="#section-fn1" class="footnote-ref" id="section-fnref1"><sup>1</sup></a></h4>
<h4 class="author">T. Churches<a href="#section-fn2" class="footnote-ref" id="section-fnref2"><sup>2</sup></a></h4>
<h4 class="author">O. Fitzgerald<a href="#section-fn3" class="footnote-ref" id="section-fnref3"><sup>3</sup></a></h4>
<h4 class="author">CR. MacIntyre<a href="#section-fn4" class="footnote-ref" id="section-fnref4"><sup>4</sup></a></h4>
<h4 class="author">L. Jorm<a href="#section-fn5" class="footnote-ref" id="section-fnref5"><sup>5</sup></a></h4>
<h4 class="date">Updated Fri 16 Jul 2021</h4>
<div class="abstract">
<p class="abstract">Abstract</p>
The ongoing COVID-19 Delta variant outbreak in Sydney has resulted in over 900 locally-acquired active cases, with 75 individuals in hospital and 18 individuals in ICU, as of 16 July 2021. Current restrictions are in place until Friday 30 July, pending further advice from NSW Health. Here we model observed cases and estimate daily incidence until 1st October under five potential scenarios for non-pharmaceutical interventions. Our results suggest that reducing daily incidence to a manageable level before September will require a contined lockdown throughout August and September during which the net effect of all restrictions is stronger than the level observed in early July. Lifting restrictions on social contacts at the end of the current lockdown period will result in a exponential rise in cases and ultimately prolong the outbreak. Maintaining restrictions at the level observed in early July is unlikely to get the outbreak under control before the start of September.
</div>

</div>


<p><img src="images/UNSW_2017_Big_Data_landscape.png" /></p>
<div id="section-aim" class="section level1">
<h1>Aim</h1>
<p>The aims of this in-brief analysis are to</p>
<ol style="list-style-type: lower-roman">
<li><p>Model observed cases from the current COVID-19 Delta-variant outbreak in Sydney, New South Wales (NSW) using a SEIR epidemic model incorporating dynamic non-pharmaceutical interventions (NPIs).</p></li>
<li><p>Project the course of the epidemic over the next six weeks under different assumptions regarding ongoing NPIs.</p></li>
</ol>
</div>
<div id="section-methods" class="section level1">
<h1>Methods</h1>
<div id="section-observed-data" class="section level2">
<h2>Observed data</h2>
Daily incidence data on the current Delta-variant outbreak in New South Wales are taken from <a href="covid19data.com.au">https://www.covid19data.com.au/nsw</a>. We exclude cases that were acquired overseas or from interstate travel and include cases with a known or unknown local source as well as those under investigation.
<div class="figure" style="text-align: center">
<img src="summary-analysis_files/figure-html/baseFig-1.png" alt="COVID-19 local transmitted cases (New South Wales, June-July 2021)" width="624" />
<p class="caption">
COVID-19 local transmitted cases (New South Wales, June-July 2021)
</p>
</div>
</div>
<div id="section-model" class="section level2">
<h2>Model</h2>
<p>We model the outbreak using an age-structured deterministic Susceptible-Exposed-Infected-Recovered (SEIR) model that accounts for dynamic non-pharmaceutical interventions (NPIs). This extended SEIR model has been implemented in our <code>COVOID</code> R package, described in detail at <a href="https://cbdrh.github.io/covoidance/">cbdrh.github.io/covoidance</a>. In brief, this model can incorporate two types of NPIs into a standard SEIR epidemic model:</p>
<ol style="list-style-type: lower-roman">
<li><p>interventions that target the average number of daily contacts between individuals from different age groups, which emulates restrictions on social activity such as stay-at home orders.</p></li>
<li><p>interventions that target the probability of transmission, emulating mask wearing, hand washing, contact tracing and case isolation.</p></li>
</ol>
<div id="section-demographics" class="section level3">
<h3>Demographics</h3>
<p>We assumed a population of 4 million unvaccinated individuals with an age distribution reflecting that of the broader Australian population. Given the relatively low proportion of fully vaccinated individuals to date, and the relatively short time frame in question, the potential role of vaccination to mitigate the current outbreak is negligible. To be conservative, we model a population around 80% the size of Sydney assuming the remaining approximately 20% are fully protected.</p>
</div>
<div id="section-disease-parameters" class="section level3">
<h3>Disease parameters</h3>
<p>We set the average duration of the incubation period to 4 days and the average duration of the infectious period to 7 days. Our calibration exercise below explored three values of R<sub>0</sub>: 6.0, 7.0 and 8.0. Note that R<sub>0</sub> is the <em>base reproduction rate</em>, absent of any intervention or immunity. This should be distinguished from R<sub>t</sub> (also known as R<sub>eff</sub>) which is the time-variant reproduction rate (or effective reproduction rate), which takes into account the effect of public health interventions and population immunity (either natural or due to vaccination).</p>
</div>
<div id="section-timeline-of-the-outbreak" class="section level3">
<h3>Timeline of the outbreak</h3>
<p>We assume the following key dates in the timeline of the current outbreak:</p>
<p><strong>June 1</strong> A hypothetical case zero of the current outbreak, an individual aged 25-30, is first exposed;</p>
<p><strong>June 16</strong> A man in his 60s working as a driver transporting international flight crew <a href="https://www.health.nsw.gov.au/news/Pages/20210616_01.aspx">tests positive for COVID-19</a>, prompting urgent contact tracing and isolation of close contacts;</p>
<p><strong>June 25</strong> Lockdowns are introduced to four Sydney Local Government Areas, soon after extended to the greater Sydney region;</p>
<p><strong>July 30</strong> Date at which current lockdown ends, pending further decisions.</p>
</div>
<div id="section-code" class="section level3">
<h3>Code</h3>
<p>The R code to replicate this analysis is available on <a href="https://github.com/CBDRH/BondiClusterRescue">GitHub</a>.</p>
</div>
</div>
</div>
<div id="section-calibration" class="section level1">
<h1>Calibration</h1>
The Delta-variant R<sub>0</sub> and the effectiveness of NPIs combine to give an effective reproduction rate R<sub>eff</sub>. Because the true value of the R<sub>0</sub> and NPI effectiveness are unknown, we undertake a calibration exercise to find combinations of these parameters which fit the observed cases. Based on the timeline above, we used the <code>COVOID</code> SEIR model to estimate the epidemic curve across a range of values for R<sub>0</sub> (4.0, 6.0, 8.0) and NPI effectiveness (30% to 70% reduction in contacts and/or transmission probability). The results of this calibration exercise are presented below.
<div class="figure" style="text-align: center">
<img src="summary-analysis_files/figure-html/calibrationFig-1.png" alt="Calibrating the SEIR model to locally transmitted cases in NSW since June 1" width="624" />
<p class="caption">
Calibrating the SEIR model to locally transmitted cases in NSW since June 1
</p>
</div>
<p><em>The points shows locally-transmitted cases of COVID-19 in NSW since June 1 2021. The red line shows the seven-day rolling average for the previous seven days. Infections acquired overseas or interstate are excluded. </em></p>
<p>Several combinations of R<sub>0</sub> and NPI effectiveness provide a reasonable fit to the data. For our main analysis we choose values of R<sub>0</sub> = 8.0 and NPI effectiveness = 50%. We also undertook an sensitivity analysis using the values of R<sub>0</sub> = 6.0 and NPI effectiveness = 30%.</p>
<p>This range of estimates of R<sub>0</sub> is consistent with the <a href="https://www.bbc.com/news/health-57431420">range of 5 to 8 estimated for the Delta variant by modellers at Imperial College London</a>.</p>
</div>
<div id="section-intervention-scenarios" class="section level1">
<h1>Intervention scenarios</h1>
<p>Our analysis assumes that the current level of restrictions remains in place until Monday 19 July. Thereafter, we projected the model under the following five scenarios.</p>
<ol style="list-style-type: decimal">
<li>Lift all restrictions on social contacts, with restrictions targeting transmission probability (mask wearing etc) remaining as they are.</li>
<li>Relax restrictions on social contacts but tighten restrictions targeting transmission probability</li>
<li>Continue with restrictions at the current level</li>
<li>Tighten restrictions on social contacts, with restrictions targeting transmission probability remaining as they are.</li>
<li>Tighten restrictions on social contacts and also tighten restrictions targeting transmission probability.</li>
</ol>
These five scenarios are summarised below.
<div class="figure" style="text-align: center">
<img src="summary-analysis_files/figure-html/interventionsFig-1.png" alt="Five scenarios for NPI effectiveness from a baseline of 50% reduction" width="624" />
<p class="caption">
Five scenarios for NPI effectiveness from a baseline of 50% reduction
</p>
</div>
<p>Note that we assume the restrictions remain in place until October 1.</p>
</div>
<div id="section-model-results" class="section level1">
<h1>Model results</h1>
The figure below shows the projected incidence based on R<sub>0</sub> = 8.0 with intervention settings as described above
<div class="figure" style="text-align: center">
<img src="summary-analysis_files/figure-html/projectionsFig-1.png" alt="Observed and projected COVID-19 incidence in NSW (1 June - 1 October 2021)" width="80%" />
<p class="caption">
Observed and projected COVID-19 incidence in NSW (1 June - 1 October 2021)
</p>
</div>
<p><em>R<sub>0</sub> = 8.0 and baseline NPI effectiveness = 50%</em></p>
<p>The results suggest that completely lifting restrictions on social contact (that is, ending the “lockdown”) would result in an epidemic rise in cases. Continuing with social contact restrictions at the level they were at in early July is unlikely to be sufficient to get the outbreak under control. To reduce daily incidence to a manageable level before will require a lockdown throughout August and October where the net effect of all restrictions is stronger than the level observed in early July (that is, currently).</p>
</div>
<div id="section-sensitivity-analysis" class="section level1">
<h1>Sensitivity analysis</h1>
<p>In order to test the robustness of our conclusions to our heuristic choice of R<sub>0</sub> and NPI effectiveness, we repeat the analysis using the alternative specification of R<sub>0</sub> = 6.0 and NPI effectiveness = 30%. We specify a similar set of five future intervention scenarios starting from the baseline of 30%.</p>
<div class="figure" style="text-align: center">
<img src="summary-analysis_files/figure-html/interventionsFig2-1.png" alt="Sensitivity analysis: Five scenarios for NPI effectiveness from a baseline of 30% reduction" width="624" />
<p class="caption">
Sensitivity analysis: Five scenarios for NPI effectiveness from a baseline of 30% reduction
</p>
</div>
<p>The figure below presents the projected case incidence based on this parameterisation.</p>
<div class="figure" style="text-align: center">
<img src="summary-analysis_files/figure-html/sensitivityFig-1.png" alt="Sensitivity analysis: Observed and projected COVID-19 incidence in NSW (1 June - 1 October 2021)" width="80%" />
<p class="caption">
Sensitivity analysis: Observed and projected COVID-19 incidence in NSW (1 June - 1 October 2021)
</p>
</div>
<p><em>R<sub>0</sub> = 6.0 and baseline NPI effectiveness = 30%</em></p>
<p>Under this model parameterisation, the main conclusion remains consistent: suppressing the current outbreak will require a lockdown throughout August where the net effect of all interventions exceeds the levels in early July.</p>
</div>
<div id="section-strengths-and-limitations" class="section level1">
<h1>Strengths and limitations</h1>
<p>Our modelling provides an open source analysis of the current COVID-19 Delta outbreak which can be reproduced and extended by other research groups. Our projections and conclusions agree with findings based on stochastic agent-based modelling from the <a href="https://burnet.edu.au/news/1465">Burnet Institute</a> and the <a href="https://arxiv.org/pdf/2107.06617v1.pdf">University of Sydney</a>, without need for computationally intensive models.</p>
<p>There is a large degree of uncertainty around the parameter specification for the SEIR model. This large parameter space makes it easy to fit the model to observed cases, but risks over-fitting which could result in low external validity. Our sensitivity analysis showed that our main conclusion was robust to different specifications of R<sub>0</sub> and NPI effectiveness.</p>
<p><strong>The findings presented here are based on a rapid interim analysis and have not yet undergone peer-review.</strong></p>
</div>
<div id="section-conclusion" class="section level1">
<h1>Conclusion</h1>
Suppressing the current COVID-19 Delta-variant outbreak in Sydney will require restrictions to remain in place throughout August at a level such that the net effect of all restrictions exceeds that observed in early July. Given the current trajectory, continuing with restrictions at the level observed in late June - early July is unlikely to get the outbreak under control. Lifting the restrictions on social contacts will likely to lead to an exponential rise in infections, and necessitate a longer and more restrictive lockdown within a matter of weeks. 
<script type="application/shiny-prerendered" data-context="server-start">
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, error = FALSE, message = FALSE, cache = FALSE)

# Install COVOID if necessary
# devtools::install_github('CBDRH/covoid', ref = 'master')

# Libraries
library(covoid)
library(tidyverse)
library(COVID19)
library(janitor)
library(lubridate)

# Global variable
DAY1 <- '2021-06-01'
TODAY <- as.Date('2021-07-16') # Most recently available observed cases
NDAYS <- as.numeric(TODAY - as.Date(DAY1) + 1) 

# Read in NSW data (last three months data downloaded from https://www.covid19data.com.au/nsw)
df <- read_csv(file = 'www/Last 3 months (true).csv') %>% 
        mutate(date = as.Date(paste0(Date, '/2021'), format = "%d/%m/%Y"),
               clusInc = `Known local source` + `Unknown local source (community spread)` + `Under investigation`,
               clusInc7 = zoo::rollmean(clusInc, k = 7, na.pad = TRUE, align = "right")) %>% 
        select(-Date) %>% 
        filter(date >= as.Date(DAY1))

# import and setup baseline states
cm_oz <- import_contact_matrix("Australia","general")
nJ <- ncol(cm_oz)
dist_oz <- import_age_distribution("Australia")
pop <- 4E6

#################################
### Define initial conditions ###
#################################

S <- dist_oz*pop
E <- c(rep(0,5), 1, rep(0,10))
I <- rep(0,length(S))
R <- rep(0,length(S))

state0 <- seir_c_state0(S = S, E = E, I = I, R = R)


#####################
### interventions ###
#####################

# Contact tracing in earnest from June 16 
dateT <- '2021-06-16' # Date that limo chauffeur was identified and contact tracing in earnest
dayT <- as.numeric(as.Date(dateT) - as.Date(DAY1))
intT30 <- data.frame(time = 1:NDAYS,  reduce = c(rep(1, dayT), rep(0.7, NDAYS-dayT))) # 30% reduction
intT40 <- data.frame(time = 1:NDAYS,  reduce = c(rep(1, dayT), rep(0.6, NDAYS-dayT))) # 40% reduction
intT50 <- data.frame(time = 1:NDAYS,  reduce = c(rep(1, dayT), rep(0.5, NDAYS-dayT))) # 50% reduction
intT60 <- data.frame(time = 1:NDAYS,  reduce = c(rep(1, dayT), rep(0.4, NDAYS-dayT))) # 60% reduction

class(intT30) <- class(intT40) <- class(intT50) <- class(intT60) <- c("data.frame", "intervention")

# Lockdown from June 25 (day 15)
dateC <- '2021-06-25' # date that lockdown began
dayC <- as.numeric(as.Date(dateC) - as.Date(DAY1))
intC30 <- data.frame(time = 1:NDAYS,  reduce = c(rep(1, dayC), rep(0.7, NDAYS-dayC))) # 30% reduction
intC40 <- data.frame(time = 1:NDAYS,  reduce = c(rep(1, dayC), rep(0.6, NDAYS-dayC))) # 40% reduction
intC50 <- data.frame(time = 1:NDAYS,  reduce = c(rep(1, dayC), rep(0.5, NDAYS-dayC))) # 50% reduction
intC60 <- data.frame(time = 1:NDAYS,  reduce = c(rep(1, dayC), rep(0.4, NDAYS-dayC))) # 60% reduction

# Have to define as appropriate class to work for COVOID
class(intC30) <- class(intC40) <- class(intC50) <- class(intC60) <- c("data.frame", "intervention")


###########################
### Calibration models ###
###########################

# model and simulation (R0 = 6, 7, 8 | Intervention = 30%, 40%, 50%, 60%)
param1a <- seir_c_param(R0 = 4.0,
                      gamma = 1/4, 
                      sigma=1/7, 
                      cm=cm_oz,
                      dist=dist_oz,
                      transmission_intervention = intT30,
                      contact_intervention = intC30)

param1b <- seir_c_param(R0 = 4.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT40,
                        contact_intervention = intC40)

param1c <- seir_c_param(R0 = 4.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT50,
                        contact_intervention = intC50)

param1d <- seir_c_param(R0 = 4.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT60,
                        contact_intervention = intC60)

param2a <- seir_c_param(R0 = 6.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT30,
                        contact_intervention = intC30)

param2b <- seir_c_param(R0 = 6.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT40,
                        contact_intervention = intC40)

param2c <- seir_c_param(R0 = 6.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT50,
                        contact_intervention = intC50)

param2d <- seir_c_param(R0 = 6.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT60,
                        contact_intervention = intC60)

param3a <- seir_c_param(R0 = 8.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT30,
                        contact_intervention = intC30)

param3b <- seir_c_param(R0 = 8.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT40,
                        contact_intervention = intC40)

param3c <- seir_c_param(R0 = 8.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT50,
                        contact_intervention = intC50)

param3d <- seir_c_param(R0 = 8.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT60,
                        contact_intervention = intC60)


# Set up list structure to store simulation output
simulation_results <- vector(mode="list",length=12)
names(simulation_results) <- paste0(rep('param',12), rep(1:3, each = 4), rep(letters[1:4], 3))

# Loop through 12 scenarios fitting SEIR model and storing output
for(i in 1:12){
 
    id <- names(simulation_results)[i]
    simulation_results[[id]] <- simulate_seir_c(t = NDAYS, state_t0 = state0, param = eval(parse(text=id)))   
}
    
# Compile the output as a data frame
dfModel <- purrr::map_df(simulation_results, ~tibble(date = .$epi$t + as.Date(DAY1) - 1,
                                            predInc = .$epi$incidence),
                                        .id = "source") %>% 
            mutate(r = factor(rep(1:3, each = NDAYS*4), levels = 1:3, labels = c('4.0', '6.0', '8.0')),
                   suppression = rep(rep(c('30%', '40%', '50%', '60%'), each = NDAYS), 3)
            )
    
# Baseline fig of existing cases    
pBase <- ggplot() +
            geom_line(data = df, aes(x = date, y = clusInc7), color = 'red', size = 3, alpha = .3) +
            geom_point(data = df, aes(x = date, y = clusInc), color = 'red', size = 1, alpha = .6) 

baseFig <- pBase +
            scale_y_continuous("Daily incidence", limits = c(0,NA)) +
            scale_x_date('Date', date_breaks = '1 month', date_labels = '%d %b') +
            labs(caption = 'Data source: covid19data.com.au')

# Plot the calibration
calibrationFig <- pBase +
                    geom_line(data = dfModel, 
                              aes(x = date, y = predInc, color = suppression), size = 1) +
                              scale_colour_manual('NPI effectiveness', values = RColorBrewer::brewer.pal(9, 'Purples')[c(3,5,7,9)]) +
                              scale_y_continuous("Daily incidence", limits = c(0, 150)) +
                              scale_x_date('Date', date_breaks = '1 month', date_labels = '%d %b') +
                              facet_wrap(~r, ncol = 3) 


###################
### Projections ###
###################

xLen <- 123 # Brings you up to Oct 1
dateL <- '2021-07-19'
nextDecision <- as.numeric(as.Date(dateL) - as.Date(DAY1)) 

# Slightly more nuanced interventions: 5 scenarios

intC50a <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayC), rep(0.50, 7), rep(0.50, nextDecision - dayC - 7), rep(1, xLen - nextDecision)))
intT50a <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayT), rep(0.50, 7), rep(0.50, nextDecision - dayT - 7), rep(0.50, xLen - nextDecision)))

intC50b <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayC), rep(0.50, 7), rep(0.50, nextDecision - dayC - 7), rep(0.7, xLen - nextDecision)))
intT50b <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayT), rep(0.50, 7), rep(0.50, nextDecision - dayT - 7), rep(0.20, xLen - nextDecision)))

intC50c <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayC), rep(0.50, 7), rep(0.50, nextDecision - dayC - 7), rep(0.50, xLen - nextDecision)))
intT50c <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayT), rep(0.50, 7), rep(0.50, nextDecision - dayT - 7), rep(0.50, xLen - nextDecision)))

intC50d <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayC), rep(0.50, 7), rep(0.50, nextDecision - dayC - 7), rep(0.20, xLen - nextDecision)))
intT50d <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayT), rep(0.50, 7), rep(0.50, nextDecision - dayT - 7), rep(0.50, xLen - nextDecision)))

intC50e <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayC), rep(0.50, 7), rep(0.50, nextDecision - dayC - 7), rep(0.20, xLen - nextDecision)))
intT50e <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayT), rep(0.50, 7), rep(0.50, nextDecision - dayT - 7), rep(0.20, xLen - nextDecision)))

# Compile as a dataframe
dfInterventions <- rbind(intC50a, intC50b, intC50c, intC50d, intC50e,
                         intT50a, intT50b, intT50c, intT50d, intT50e) %>% 
                    mutate(
                        date = as.Date(DAY1) + time - 1,
                        type = c(rep('Social contact', xLen*5), rep('Transmission probability', xLen*5)),
                        scenario = factor(rep(rep(1:5, each = xLen), 2), 
                                          levels = 1:5, 
                                          labels = paste('Scenario', 1:5))
                    )

scenarioLabs <- c('Lift restrictions  on social contacts',
                     'Relax restrictions on social contacts\nbut limit transmission probability',
                     'Continue at current level',
                     'Tighten restrictions on social contacts',
                     'Tighten restrictions  on social contacts\nand limit transmission probability')

# Illustrate the interventions
interventionsFig <- dfInterventions %>% 
                        ggplot(aes(x = date, y = reduce, group = scenario, color = scenario, fill = scenario)) + 
                            geom_line(size = 1.4) + 
                            geom_ribbon(aes(x = date, ymax = reduce, ymin = 0), alpha = 0.2) +
                            facet_wrap(scenario~type, nrow = 2, dir = 'v') +
                            scale_colour_manual(NULL, values = RColorBrewer::brewer.pal(5, 'Set1'), labels = scenarioLabs) +
                            scale_fill_manual(NULL, values = RColorBrewer::brewer.pal(5, 'Set1'), labels = scenarioLabs) +
                            scale_y_continuous("NPI effectiveness", labels = scales::percent, limits = c(0,1), breaks = seq(0,1,.2)) +
                            scale_x_date('Date', date_breaks = '1 month', date_labels = '%b') +
                            theme(legend.position = 'bottom') +
                            guides(color = guide_legend(nrow = 3)) 

# Have to define as appropriate class to work for COVOID
class(intC50a) <- class(intC50b) <- class(intC50c) <- class(intC50d) <- class(intC50e) <- 
class(intT50a) <- class(intT50b) <- class(intT50c) <- class(intT50d) <- class(intT50e) <- c("data.frame", "intervention")


# Define COVOID params based on these interventions (Note R0 = 8)
param850a <- seir_c_param(R0 = 8.0,
                        gamma = 1/4, 
                        sigma=1/7, 
                        cm=cm_oz,
                        dist=dist_oz,
                        transmission_intervention = intT50a,
                        contact_intervention = intC50a)

param850b <- seir_c_param(R0 = 8.0,
                          gamma = 1/4, 
                          sigma=1/7, 
                          cm=cm_oz,
                          dist=dist_oz,
                          transmission_intervention = intT50b,
                          contact_intervention = intC50b)

param850c <- seir_c_param(R0 = 8.0,
                          gamma = 1/4, 
                          sigma=1/7, 
                          cm=cm_oz,
                          dist=dist_oz,
                          transmission_intervention = intT50c,
                          contact_intervention = intC50c)

param850d <- seir_c_param(R0 = 8.0,
                          gamma = 1/4, 
                          sigma=1/7, 
                          cm=cm_oz,
                          dist=dist_oz,
                          transmission_intervention = intT50d,
                          contact_intervention = intC50d)

param850e <- seir_c_param(R0 = 8.0,
                          gamma = 1/4, 
                          sigma=1/7, 
                          cm=cm_oz,
                          dist=dist_oz,
                          transmission_intervention = intT50e,
                          contact_intervention = intC50e)


# Set up list structure to store estimates
simulation_results2 <- vector(mode="list",length=5)
names(simulation_results2) <- paste0(rep('param850', 5), letters[1:5])


# Loop through 5 scenarios, fit SEIR models and store results
for(i in 1:length(simulation_results2)){
    
    id <- names(simulation_results2)[i]
    simulation_results2[[id]] <- simulate_seir_c(t = xLen, state_t0 = state0, param = eval(parse(text=id)))
    
}


# Compile the results as a dataframe
dfModel2 <- purrr::map_df(simulation_results2, ~tibble(date = .$epi$t + as.Date(DAY1) - 1,
                                                     predInc = .$epi$incidence),
                         .id = "source") %>% 
    mutate(scenario = factor(rep(1:5, each = xLen), levels = 1:5, 
                                          labels = c('Lift restrictions on social contacts', 
                                                     'Relax restrictions on social contacts\nbut limit transmission probability', 
                                                     'Continue at current level', 
                                                     'Tighten restrictions on social contacts',
                                                     'Tighten restrictions on social contacts\nand limit transmission probability'))
        )

# Visualise the projections
projectionsFig <- pBase +
    geom_line(data = dfModel2, 
              aes(x = date, y = predInc, color = scenario), size = 1) +
              annotate('text', x = as.Date('2021-07-07'), y = 400, label = 'Mon 19 July', color = 'grey60') +
              geom_vline(aes(xintercept = as.Date(dateL)), color = 'grey60', size = 1.4) + 
              scale_colour_manual(NULL, values = RColorBrewer::brewer.pal(5, 'Set1')) +
              scale_y_continuous("Daily incidence", limits = c(0,400)) +
              scale_x_date('Date', date_breaks = '1 month', date_labels = '%d %b') +
              theme(legend.position = 'bottom') +
              guides(color = guide_legend(nrow = 3)) 



############################
### Sensitivity analysis ###
############################

# Slightly more nuanced interventions: 5 scenarios

intC30a <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayC), rep(0.70, 7), rep(0.70, nextDecision - dayC - 7), rep(1, xLen - nextDecision)))
intT30a <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayT), rep(0.70, 7), rep(0.70, nextDecision - dayT - 7), rep(0.70, xLen - nextDecision)))

intC30b <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayC), rep(0.70, 7), rep(0.70, nextDecision - dayC - 7), rep(0.90, xLen - nextDecision)))
intT30b <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayT), rep(0.70, 7), rep(0.70, nextDecision - dayT - 7), rep(0.30, xLen - nextDecision)))

intC30c <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayC), rep(0.70, 7), rep(0.70, nextDecision - dayC - 7), rep(0.70, xLen - nextDecision)))
intT30c <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayT), rep(0.70, 7), rep(0.70, nextDecision - dayT - 7), rep(0.70, xLen - nextDecision)))

intC30d <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayC), rep(0.70, 7), rep(0.70, nextDecision - dayC - 7), rep(0.30, xLen - nextDecision)))
intT30d <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayT), rep(0.70, 7), rep(0.70, nextDecision - dayT - 7), rep(0.70, xLen - nextDecision)))

intC30e <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayC), rep(0.70, 7), rep(0.70, nextDecision - dayC - 7), rep(0.30, xLen - nextDecision)))
intT30e <- data.frame(time = 1:xLen,  reduce = c(rep(1, dayT), rep(0.70, 7), rep(0.70, nextDecision - dayT - 7), rep(0.30, xLen - nextDecision)))

# Compile as a dataframe
dfInterventions2 <- rbind(intC30a, intC30b, intC30c, intC30d, intC30e,
                         intT30a, intT30b, intT30c, intT30d, intT30e) %>% 
    mutate(
        date = as.Date(DAY1) + time - 1,
        type = c(rep('Social contact', xLen*5), rep('Transmission probability', xLen*5)),
        scenario = factor(rep(rep(1:5, each = xLen), 2), 
                          levels = 1:5, 
                          labels = paste('Scenario', 1:5))
    )

# Illustrate the interventions
interventionsFig2 <- dfInterventions2 %>% 
    ggplot(aes(x = date, y = reduce, group = scenario, color = scenario, fill = scenario)) + 
    geom_line(size = 1.4) + 
    geom_ribbon(aes(x = date, ymax = reduce, ymin = 0), alpha = 0.2) +
    facet_wrap(scenario~type, nrow = 2, dir = 'v') +
    scale_colour_manual(NULL, values = RColorBrewer::brewer.pal(5, 'Set1'), labels = scenarioLabs) +
    scale_fill_manual(NULL, values = RColorBrewer::brewer.pal(5, 'Set1'), labels = scenarioLabs) +
    scale_y_continuous("NPI effectiveness", labels = scales::percent, limits = c(0,1), breaks = seq(0,1,.2)) +
    scale_x_date('Date', date_breaks = '1 month', date_labels = '%b') +
    theme(legend.position = 'bottom') +
    guides(color = guide_legend(nrow = 3)) 

# Have to define as appropriate class to work for COVOID
class(intC30a) <- class(intC30b) <- class(intC30c) <- class(intC30d) <- class(intC30e) <- 
    class(intT30a) <- class(intT30b) <- class(intT30c) <- class(intT30d) <- class(intT30e) <- c("data.frame", "intervention")


# Define COVOID params based on these interventions (Note R0 = 8)
param630a <- seir_c_param(R0 = 6.0,
                          gamma = 1/4, 
                          sigma=1/7, 
                          cm=cm_oz,
                          dist=dist_oz,
                          transmission_intervention = intT30a,
                          contact_intervention = intC30a)

param630b <- seir_c_param(R0 = 6.0,
                          gamma = 1/4, 
                          sigma=1/7, 
                          cm=cm_oz,
                          dist=dist_oz,
                          transmission_intervention = intT30b,
                          contact_intervention = intC30b)

param630c <- seir_c_param(R0 = 6.0,
                          gamma = 1/4, 
                          sigma=1/7, 
                          cm=cm_oz,
                          dist=dist_oz,
                          transmission_intervention = intT30c,
                          contact_intervention = intC30c)

param630d <- seir_c_param(R0 = 6.0,
                          gamma = 1/4, 
                          sigma=1/7, 
                          cm=cm_oz,
                          dist=dist_oz,
                          transmission_intervention = intT30d,
                          contact_intervention = intC30d)

param630e <- seir_c_param(R0 = 6.0,
                          gamma = 1/4, 
                          sigma=1/7, 
                          cm=cm_oz,
                          dist=dist_oz,
                          transmission_intervention = intT30e,
                          contact_intervention = intC30e)


# Set up list structure to store estimates
simulation_results3 <- vector(mode="list",length=5)
names(simulation_results3) <- paste0(rep('param630', 5), letters[1:5])


# Loop through 5 scenarios, fit SEIR models and store results
for(i in 1:length(simulation_results3)){
    
    id <- names(simulation_results3)[i]
    simulation_results3[[id]] <- simulate_seir_c(t = xLen, state_t0 = state0, param = eval(parse(text=id)))
    
}


# Compile the results as a dataframe
dfModel3 <- purrr::map_df(simulation_results3, ~tibble(date = .$epi$t + as.Date(DAY1) - 1,
                                                       predInc = .$epi$incidence),
                          .id = "source") %>% 
    mutate(scenario = factor(rep(1:5, each = xLen), levels = 1:5, 
                             labels = c('Lift restrictions on social contacts', 
                                        'Relax restrictions on social contacts\nbut limit transmission probability', 
                                        'Continue at current level', 
                                        'Tighten restrictions on social contacts',
                                        'Tighten restrictions on social contacts\nand limit transmission probability'))
    )

# Visualise the projections
sensitivityFig <- pBase +
    geom_line(data = dfModel3, 
              aes(x = date, y = predInc, color = scenario), size = 1) +
    annotate('text', x = as.Date('2021-07-07'), y = 400, label = 'Mon 19 July', color = 'grey60') +
    geom_vline(aes(xintercept = as.Date(dateL)), color = 'grey60', size = 1.4) + 
    scale_colour_manual(NULL, values = RColorBrewer::brewer.pal(5, 'Set1')) +
    scale_y_continuous("Daily incidence", limits = c(0, 400)) +
    scale_x_date('Date', date_breaks = '1 month', date_labels = '%d %b') +
    theme(legend.position = 'bottom') +
    guides(color = guide_legend(nrow = 3)) 


</script>
 <!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/bootstrap.min.css"]},{"type":"character","attributes":{},"value":["<style>h1 {font-size: 34px;}\n       h1.title {font-size: 38px;}\n       h2 {font-size: 30px;}\n       h3 {font-size: 24px;}\n       h4 {font-size: 18px;}\n       h5 {font-size: 16px;}\n       h6 {font-size: 12px;}\n       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}\n       pre:not([class]) { background-color: white }<\/style>"]},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["navigation"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/navigation-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tabsets.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.8"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files","pkgVersion"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["9.12.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/highlightjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["default.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["2.8"]}]}]}
</script>
<!--/html_preserve-->
<!--html_preserve-->
<script type="application/shiny-prerendered" data-context="execution_dependencies">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["packages","version"]},"class":{"type":"character","attributes":{},"value":["data.frame"]},"row.names":{"type":"integer","attributes":{},"value":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87]}},"value":[{"type":"character","attributes":{},"value":["assertthat","backports","base","broom","bslib","cellranger","cli","colorspace","compiler","COVID19","covoid","crayon","datasets","DBI","dbplyr","deSolve","digest","dplyr","ellipsis","evaluate","fansi","farver","fastmap","forcats","fs","generics","ggplot2","glue","graphics","grDevices","grid","gtable","haven","highr","hms","htmltools","httpuv","httr","janitor","jquerylib","jsonlite","knitr","labeling","later","lattice","lifecycle","lubridate","magrittr","methods","mime","modelr","munsell","pillar","pkgconfig","promises","purrr","R6","RColorBrewer","Rcpp","readr","readxl","reprex","rlang","rmarkdown","rstudioapi","rvest","sass","scales","shiny","snakecase","stats","stringi","stringr","tibble","tidyr","tidyselect","tidyverse","tools","utf8","utils","vctrs","withr","xfun","xml2","xtable","yaml","zoo"]},{"type":"character","attributes":{},"value":["0.2.1","1.2.1","4.0.3","0.7.6","0.2.5.1","1.1.0","2.5.0","2.0-1","4.0.3","2.3.2","0.2.0","1.4.1","4.0.3","1.1.1","2.1.1","1.28","0.6.27","1.0.6","0.3.2","0.14","0.5.0","2.1.0","1.1.0","0.5.1","1.5.0","0.1.0","3.3.3","1.4.2","4.0.3","4.0.3","4.0.3","0.3.0","2.4.1","0.9","1.1.0","0.5.1.1","1.6.1","1.4.2","2.1.0","0.1.4","1.7.2","1.33","0.4.2","1.2.0","0.20-41","1.0.0","1.7.10","2.0.1","4.0.3","0.10","0.1.8","0.5.0","1.6.1","2.0.3","1.2.0.1","0.3.4","2.5.0","1.1-2","1.0.6","1.4.0","1.3.1","2.0.0","0.4.11","2.8","0.13","1.0.0","0.4.0","1.1.1","1.6.0","0.11.0","4.0.3","1.6.2","1.4.0","3.1.2","1.1.3","1.1.1","1.3.1","4.0.3","1.2.1","4.0.3","0.3.8","2.4.2","0.23","1.3.2","1.8-4","2.2.1","1.8-9"]}]}]}
</script>
<!--/html_preserve-->
</div>
<div class="footnotes">
<hr />
<ol>
<li id="section-fn1"><p>Centre for Big Data Research in Health, UNSW Sydney<a href="#section-fnref1" class="footnote-back">↩︎</a></p></li>
<li id="section-fn2"><p>South Western Sydney Clinical School, UNSW Sydney | Ingham Institute for Applied Medical Research<a href="#section-fnref2" class="footnote-back">↩︎</a></p></li>
<li id="section-fn3"><p>Centre for Big Data Research in Health, UNSW Sydney<a href="#section-fnref3" class="footnote-back">↩︎</a></p></li>
<li id="section-fn4"><p>Biosecurity Research Program, The Kirby Institute, UNSW Sydney<a href="#section-fnref4" class="footnote-back">↩︎</a></p></li>
<li id="section-fn5"><p>Centre for Big Data Research in Health, UNSW Sydney<a href="#section-fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("section-TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
